apiVersion: v1
kind: ConfigMap
metadata:
  name: mysql-init-scripts
  namespace: autoprotocoltrans
data:
  V1__create_mapping_config_table.sql: |
    -- 创建映射配置表
    CREATE TABLE IF NOT EXISTS `mapping_config` (
        `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT '主键ID',
        `name` VARCHAR(255) NOT NULL COMMENT '配置名称（唯一）',
        `description` TEXT COMMENT '配置描述',
        `config_content` LONGTEXT NOT NULL COMMENT '配置内容（JSON格式）',
        `create_time` DATETIME NOT NULL COMMENT '创建时间',
        `update_time` DATETIME NOT NULL COMMENT '更新时间',
        PRIMARY KEY (`id`),
        UNIQUE KEY `uk_name` (`name`)
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='映射配置表';
  V2__create_dictionary_table.sql: |
    -- 创建字典表
    CREATE TABLE IF NOT EXISTS `dictionary` (
        `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT '主键ID',
        `name` VARCHAR(255) NOT NULL COMMENT '字典名称（唯一）',
        `code` VARCHAR(255) NOT NULL COMMENT '字典编码（唯一）',
        `description` TEXT COMMENT '字典描述',
        `create_time` DATETIME NOT NULL COMMENT '创建时间',
        `update_time` DATETIME NOT NULL COMMENT '更新时间',
        PRIMARY KEY (`id`),
        UNIQUE KEY `uk_name` (`name`),
        UNIQUE KEY `uk_code` (`code`),
        KEY `idx_code` (`code`)
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='字典表';
  V3__create_dictionary_item_table.sql: |
    -- 创建字典项表
    CREATE TABLE IF NOT EXISTS `dictionary_item` (
        `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT '主键ID',
        `dictionary_id` BIGINT(20) NOT NULL COMMENT '字典ID（关联dictionary表）',
        `dict_key` VARCHAR(255) NOT NULL COMMENT '字典键（key）',
        `dict_value` VARCHAR(500) NOT NULL COMMENT '字典值（value）',
        `sort_order` INT(11) DEFAULT 0 COMMENT '排序序号',
        `create_time` DATETIME NOT NULL COMMENT '创建时间',
        `update_time` DATETIME NOT NULL COMMENT '更新时间',
        PRIMARY KEY (`id`),
        KEY `idx_dictionary_id` (`dictionary_id`),
        KEY `idx_dict_key` (`dict_key`),
        CONSTRAINT `fk_dictionary_item_dictionary` FOREIGN KEY (`dictionary_id`) REFERENCES `dictionary` (`id`) ON DELETE CASCADE
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='字典项表';
  V4__create_custom_function_table.sql: |
    -- 创建自定义函数表
    CREATE TABLE IF NOT EXISTS `custom_function` (
        `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT '主键ID',
        `name` VARCHAR(255) NOT NULL COMMENT '函数名称（唯一）',
        `code` VARCHAR(255) NOT NULL COMMENT '函数编码（唯一）',
        `description` TEXT COMMENT '函数描述',
        `script` LONGTEXT NOT NULL COMMENT 'Groovy脚本代码',
        `enabled` TINYINT(1) NOT NULL DEFAULT 1 COMMENT '是否启用（1:启用，0:禁用）',
        `create_time` DATETIME NOT NULL COMMENT '创建时间',
        `update_time` DATETIME NOT NULL COMMENT '更新时间',
        PRIMARY KEY (`id`),
        UNIQUE KEY `uk_name` (`name`),
        UNIQUE KEY `uk_code` (`code`),
        KEY `idx_code` (`code`),
        KEY `idx_enabled` (`enabled`)
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='自定义函数表';

