# 画布编辑器使用说明

## 功能概述

画布编辑器提供了可视化的报文映射配置界面，支持通过拖拽连线的方式配置字段映射关系。

## 主要功能

### 1. 源数据树（左侧）
- 输入或粘贴源JSON数据
- 自动解析JSON结构，显示为树形结构
- 每个节点显示字段名和数据类型
- 节点可拖拽到画布

### 2. 目标数据树（右侧）
- 输入或粘贴目标JSON结构（用于参考）
- 自动解析JSON结构，显示为树形结构
- 节点可拖拽到画布

### 3. 画布区域（中间）
- 支持拖拽源节点和目标节点到画布
- 支持在节点之间连线（从源节点到目标节点）
- 支持节点的拖拽移动
- 支持删除节点和连线（选中后按Delete键）
- 支持画布缩放和平移（鼠标滚轮缩放，拖拽平移）

### 4. 连线配置
- 点击连线打开配置对话框
- 可配置：
  - 映射类型：1对1、1对多、多对1
  - 转换类型：直接赋值、函数映射、Groovy脚本、字典映射、固定值
  - 根据转换类型配置相应参数

### 5. 导出配置
- 点击"导出配置"按钮
- 将画布上的所有连线转换为MappingConfig格式
- 配置会复制到剪贴板，可直接使用

### 6. 测试转换
- 配置好映射规则后，点击"测试转换"
- 系统会调用后端API执行转换
- 转换结果会显示在右侧目标数据区域

## 使用步骤

1. **输入源数据**
   - 在左侧"源数据"文本框中输入JSON数据
   - 系统自动解析并显示为树形结构

2. **输入目标结构（可选）**
   - 在右侧"目标数据"文本框中输入目标JSON结构
   - 主要用于参考，了解目标结构

3. **创建节点**
   - 从左侧树拖拽字段到画布（创建源节点，蓝色）
   - 从右侧树拖拽字段到画布（创建目标节点，紫色）

4. **创建连线**
   - 从源节点拖拽到目标节点创建连线
   - 连线默认使用"直接赋值"转换类型

5. **配置转换规则**
   - 点击连线打开配置对话框
   - 选择映射类型和转换类型
   - 根据转换类型配置相应参数
   - 点击"确定"保存配置

6. **导出配置**
   - 配置完成后，点击"导出配置"
   - 配置会复制到剪贴板

7. **测试转换**
   - 点击"测试转换"按钮
   - 查看转换结果

## 快捷键

- `Delete` 或 `Backspace`：删除选中的节点或连线

## 注意事项

1. 源数据必须是有效的JSON格式
2. 目标结构主要用于参考，不是必需的
3. 连线必须从源节点到目标节点
4. 一个目标节点可以连接多个源节点（多对1映射）
5. 节点删除时会自动删除相关的连线

## 配置示例

导出的配置格式如下：

```json
{
  "sourceProtocol": "JSON",
  "targetProtocol": "JSON",
  "prettyPrint": true,
  "rules": [
    {
      "sourcePath": "$.user.name",
      "targetPath": "customer.userName",
      "mappingType": "ONE_TO_ONE",
      "transformType": "DIRECT",
      "transformConfig": {}
    }
  ]
}
```

